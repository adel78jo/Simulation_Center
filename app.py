import streamlit as st
import pandas as pd
from datetime import datetime

# ==========================================
# ๐ 1. ุฅุนุฏุงุฏุงุช ุงููุตุงุฏูุฉ (ุงูุฃูุงู) ๐ก๏ธ
# ูุฌุจ ุชุบููุฑ ูุฐู ุงูููู ุฅูู ููู ุณุฑูุฉ ุฎุงุตุฉ ุจู!
# ==========================================
ADMIN_USER = "admin"  # ูู ุจุชุบููุฑู
ADMIN_PASS = "AABU2025"  # ูู ุจุชุบููุฑู ุฅูู ูููุฉ ูุฑูุฑ ูููุฉ

# --- ุชููุฆุฉ ุงูุจูุงูุงุช ูุงูุชุฎุฒูู (Session State) ---
# ุงูุชุฃูุฏ ูู ุชููุฆุฉ ุญุงูุฉ ุชุณุฌูู ุงูุฏุฎูู
if 'logged_in' not in st.session_state:
    st.session_state['logged_in'] = False

# ุงูุจูุงูุงุช ุงูุฃูููุฉ (ูููู ูููุฏูุฑ ุชุนุฏูููุง ูุญุฐููุง)
if 'courses' not in st.session_state:
    st.session_state['courses'] = {
        1: {"Name": "ุฃุณุงุณูุงุช ุงููุญุงูุงุฉ (Arena)", "Status": "ูุชุงุญุฉ ููุชุณุฌูู"},
        2: {"Name": "ุงูููุฐุฌุฉ ุงูุฑูุงุถูุฉ (Matlab)", "Status": "ูุชุงุญุฉ ููุชุณุฌูู"},
        3: {"Name": "ุงููุงูุน ุงูุงูุชุฑุงุถู ูุงููุนุฒุฒ (VR/AR)", "Status": "ููุฏ ุงูุฅุนุฏุงุฏ"},
    }
if 'trainees' not in st.session_state:
    st.session_state['trainees'] = {
        101: {"Name": "ุฎุงูุฏ ูุญูุฏ", "Type": "ุทุงูุจ ุจูุงููุฑููุณ", "College": "ุชูููููุฌูุง ุงููุนูููุงุช", "Course_ID": 1, "Course_Name": "ุฃุณุงุณูุงุช ุงููุญุงูุงุฉ (Arena)", "Date": "2025-11-01"},
        102: {"Name": "ุณุงุฑุฉ ุนูู", "Type": "ุทุงูุจ ุฏุฑุงุณุงุช ุนููุง", "College": "ุงูููุฏุณุฉ", "Course_ID": 2, "Course_Name": "ุงูููุฐุฌุฉ ุงูุฑูุงุถูุฉ (Matlab)", "Date": "2025-11-05"},
    }
if 'audit_logs' not in st.session_state:
    st.session_state['audit_logs'] = {
        201: {"Lab": "ูุฎุชุจุฑ ุงูููุฐุฌุฉ", "Auditor": "ุฃุญูุฏ ุญุณูู", "Time": "2025-11-20 09:00", "Status": "ููุชุงุฒ", "Notes": "ุฌููุน ุงูุจุฑุงูุฌ ุชุนูู ุจุงูุชูุงุฒ."},
        202: {"Lab": "ูุงุนุฉ ุงูุชุฏุฑูุจ 1", "Auditor": "ููู ุฎุงูุฏ", "Time": "2025-11-21 11:30", "Status": "ูุญุชุงุฌ ูุชุงุจุนุฉ ููุฑูุฉ", "Notes": "ุนุทู ูู ุฌูุงุฒ ุงูุนุฑุถ."},
    }

# --- ูุธุงุฆู ุงููุฏูุฑ ุงูุนุงูุฉ (CRUD Helpers) ---
def get_next_id(data_dict):
    """ููุฑุฌุน ุงููุนุฑู (ID) ุงูุชุงูู ูู ุงููุงููุณ."""
    return max(data_dict.keys()) + 1 if data_dict else 1

def delete_item(data_dict, item_id):
    """ูุญุฐู ุนูุตุฑุงู ูู ุงููุงููุณ."""
    if item_id in data_dict:
        del data_dict[item_id]
        return True
    return False

# --- ูุธููุฉ ุชุณุฌูู ุงูุฏุฎูู ---
def login_user(username, password):
    if username == ADMIN_USER and password == ADMIN_PASS:
        st.session_state['logged_in'] = True
        st.success("๐ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ! ููููู ุงูุขู ุงููุตูู ูุฅุฏุงุฑุฉ ุงููุธุงู.")
        st.experimental_rerun() # ุฅุนุงุฏุฉ ุชุดุบูู ุงูุตูุญุฉ ูุนุฑุถ ุงููุญุชูู
    else:
        st.error("โ ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ.")

# --- ูุธููุฉ ุชุณุฌูู ุงูุฎุฑูุฌ ---
def logout_user():
    st.session_state['logged_in'] = False
    st.warning("ุชู ุชุณุฌูู ุงูุฎุฑูุฌ. ูุญุชูู ุงูุฅุฏุงุฑุฉ ุบูุฑ ูุชุงุญ.")
    st.experimental_rerun()


# --- ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ ูุงูุชุตููู ุงูุงุญุชุฑุงูู ---
st.set_page_config(
    page_title="ุดุนุจุฉ ุงูุชุฏุฑูุจ ูุงูุชุทููุฑ ูุงูุชุฏููู ูุงูุชูุนูุฉ",
    layout="wide",
    initial_sidebar_state="expanded",
    page_icon="๐จโ๐ซ" 
)

# ุชุนุฏูู ุดูู ุงูุฎุทูุท ูุงูุฃููุงู ุนุจุฑ ุญูู CSS ูุชุญุณูู ุงููุงุฌูุฉ
st.markdown("""
<style>
    /* ุฏุนู ุงูุงุชุฌุงู ูู ุงููููู ูููุณุงุฑ ุจุดูู ูุงูู */
    .stApp {
        direction: rtl;
        text-align: right;
        font-family: 'Arial', 'Tahoma', sans-serif; /* ุฎุทูุท ุฃุฌูู ูุฃูุซุฑ ุงุญุชุฑุงููุฉ */
    }
    /* ุฎุทูุท ูุนูุงููู ุฃูุซุฑ ุฌุงุฐุจูุฉ */
    h1, h2, h3, h4, h5, h6 {
        color: #004d40; /* ููู ุงูุฃุฎุถุฑ ุงูุฏุงูู (Teal/Emerald) */
        font-family: 'Arial', 'Tahoma', sans-serif;
    }
    /* ุงูุฃููุงู ุงูุฃุณุงุณูุฉ ููุฃุฒุฑุงุฑ ูุงูููููุงุช */
    .stButton>button {
        background-color: #00796b; /* ุฃุฎุถุฑ ุบุงูู ุงุญุชุฑุงูู */
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 16px;
        font-weight: bold;
        transition: background-color 0.3s ease;
    }
    .stButton>button:hover {
        background-color: #009688; /* ููู ูุงุชุญ ุนูุฏ ุงููุฑูุฑ */
    }
    /* ุชุตููู ุจุทุงูุงุช ุงูู Metrics */
    [data-testid="stMetric"] {
        background-color: #e0f2f1; /* ุฎูููุฉ ูุงุชุญุฉ ููุจุทุงูุงุช */
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); /* ุธู ุงุญุชุฑุงูู */
        text-align: center;
    }
    [data-testid="stMetricLabel"] {
        font-size: 1.2em;
        color: #004d40; /* ุฃุฎุถุฑ ุฏุงูู ููุนูุงูุฉ */
        font-weight: bold;
    }
    [data-testid="stMetricValue"] {
        font-size: 3em;
        color: #00796b; /* ููู ุงููููุฉ ุงูุฑุฆูุณู */
        font-weight: bolder;
    }
    /* ุชุญุณูู ุงูุชุจุงุนุฏ ูู ุงูุฃูุณุงู */
    .stContainer {
        padding-top: 15px;
        padding-bottom: 15px;
    }
    /* ุฅุฒุงูุฉ ุญุฏูุฏ DataFrame ุงูุงูุชุฑุงุถูุฉ */
    .stDataFrame {
        border: 1px solid #ddd !important; /* ุญุฏูุฏ ุฎูููุฉ ูุฃูููุฉ */
        border-radius: 8px;
    }
</style>
""", unsafe_allow_html=True)


# --- ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ููุชููู ---
st.sidebar.markdown("# ๐๏ธ ุฌุงูุนุฉ ุขู ุงูุจูุช")
st.sidebar.markdown("## ุดุนุจุฉ ุงูุชุฏุฑูุจ ูุงูุชุทููุฑ ูุงูุชุฏููู ูุงูุชูุนูุฉ")
st.sidebar.markdown("---")

menu = st.sidebar.radio(
    "ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ:",
    ("๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ", "๐ ุชุณุฌูู ุงูุฏูุฑุงุช", "๐ ุงูุชุฏููู ูุงููุชุงุจุนุฉ", "๐ ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช", "๐ ุฅุฏุงุฑุฉ ุงููุธุงู ุงููุงููุฉ")
)
st.sidebar.markdown("---")

if st.session_state['logged_in']:
    st.sidebar.button("๐ ุชุณุฌูู ุงูุฎุฑูุฌ", on_click=logout_user)
else:
    st.sidebar.info("ูููุตูู ูุฅุฏุงุฑุฉ ุงููุธุงูุ ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู.")


# ==========================================
# 1. ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (ูุงุฌูุฉ ุงุญุชุฑุงููุฉ ูุนุจุฑุฉ)
# ==========================================
if menu == "๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ":
    st.image("https://www.aabu.edu.jo/sites/AABU/Main/SiteAssets/logo.png", width=150) # ุดุนุงุฑ ุงูุฌุงูุนุฉ
    st.title("ูุฑุญุจุงู ุจู ูู ูุธุงู ุฅุฏุงุฑุฉ ุดุนุจุฉ ุงูุชุฏุฑูุจ ูุงูุชุทููุฑ ูุงูุชุฏููู ูุงูุชูุนูุฉ")
    st.subheader("ูุฑูุฒ ุงูููุฐุฌุฉ ูุงููุญุงูุงุฉ - ุฌุงูุนุฉ ุขู ุงูุจูุช")
    
    st.container(border=True): # ุงุณุชุฎุฏุงู ุญุงููุฉ ูุชุญุณูู ุงูุดูู
        st.markdown("""
        **ุฑุคูุชูุง:** ุงูุงุฑุชูุงุก ุจุงูููุงุกุงุชุ ุถูุงู ุงูุฌูุฏุฉุ ูุชุญููุฒ ุงูุงุจุชูุงุฑ ูู ูุฌุงูุงุช ุงูููุฐุฌุฉ ูุงููุญุงูุงุฉ.
        ูุญู ูุณุนู ูุชูุฏูู ุฃูุถู ุจุฑุงูุฌ ุงูุชุฏุฑูุจุ ูุน ุชุทุจูู ุฃุนูู ูุนุงููุฑ ุงูุชุฏููู ูุงููุชุงุจุนุฉ ูุถูุงู ุงูุชููุฒ.
        """)
    
    st.markdown("---")
    
    # ุจุทุงูุงุช ูุนูููุงุช ุณุฑูุนุฉ
    col1, col2, col3 = st.columns(3)
    col1
